name: "‚ö° EnigMano Windows 11 Quick Deployment"

on:
  workflow_dispatch:

jobs:
  deploy-enigmano:
    runs-on: windows-2025

    env:
      TAILSCALE_AUTHKEY: ${{ secrets.TAILSCALE_AUTHKEY }}

    steps:
      - name: üì• Download EnigMano-instance.ps1
        shell: pwsh
        run: |
          Invoke-WebRequest -Uri "https://gitlab.com/Shahzaib-YT/enigmano-windows-11-with-sound/-/raw/main/EnigMano-Instance.ps1" -OutFile "EnigMano-Instance.ps1"

      - name: üîó Install & Connect Tailscale
        shell: pwsh
        run: |
          msiexec /i https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi /qn
          Start-Sleep -Seconds 10
          & 'C:\Program Files\Tailscale\tailscale.exe' up --authkey $env:TAILSCALE_AUTHKEY --accept-routes --accept-dns
          Write-Host "üåç Tailscale IP (IPv4):"
          & 'C:\Program Files\Tailscale\tailscale.exe' ip -4
          Write-Host "üåç Tailscale IP (IPv6):"
          & 'C:\Program Files\Tailscale\tailscale.exe' ip -6

      - name: ‚öîÔ∏è Execute EnigMano Instance Script
        shell: pwsh
        run: |
          powershell.exe -ExecutionPolicy Bypass -File ".\EnigMano-Instance.ps1"

      - name: ‚è≥ Keep Alive (6h)
        shell: pwsh
        run: |
          for ($i=0; $i -lt 72; $i++) {
            Write-Host "üíì Keep-alive ping $i"
            Start-Sleep -Seconds 300
          }
